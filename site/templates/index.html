<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Manager & System Monitor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #0a0a0a;
            color: #e0e0e0;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #2a2a2a;
            border-color: #00ffff;
        }

        .tab.active {
            background: #2a2a2a;
            border-color: #00ffff;
            color: #00ffff;
        }

        .tab-content {
            display: none;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .tab-content.active {
            display: block;
        }

        /* System Monitor Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #0d0d0d;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #333;
        }

        .stat-card h3 {
            color: #00ffff;
            margin-bottom: 10px;
        }

        .progress-bar {
            background: #333;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #ff00ff);
            transition: width 0.5s ease;
        }

        /* File Manager Styles */
        .file-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            background: #2a2a2a;
            border: 1px solid #444;
            color: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #3a3a3a;
            border-color: #00ffff;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00ffff, #0088cc);
            border: none;
            color: #000;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff0044, #cc0033);
            border: none;
            color: #fff;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #00cc88, #006644);
            border: none;
            color: #fff;
        }

        /* Upload Progress Styles */
        #upload-progress {
            background: #0d0d0d;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        #upload-status {
            font-size: 14px;
            font-weight: bold;
        }

        #upload-counter {
            font-size: 12px;
            opacity: 0.8;
        }

        .upload-progress-bar {
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .upload-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #00aa88);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .file-browser {
            background: #0d0d0d;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 10px;
            max-height: 500px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #222;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-item:hover {
            background: #1a1a1a;
        }

        .file-item.selected {
            background: #2a2a2a;
            border-left: 3px solid #00ffff;
        }

        .file-icon {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .folder-icon {
            color: #ffcc00;
        }

        .python-icon {
            color: #3776ab;
        }

        /* Proxy Browser */
        .proxy-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .url-input {
            flex: 1;
            padding: 10px;
            background: #0d0d0d;
            border: 1px solid #333;
            color: #e0e0e0;
            border-radius: 5px;
        }

        .proxy-frame {
            width: 100%;
            height: 600px;
            border: 1px solid #333;
            border-radius: 5px;
            background: #fff;
        }

        /* Network Info */
        .ip-list {
            background: #0d0d0d;
            padding: 20px;
            border-radius: 10px;
        }

        .ip-item {
            padding: 10px;
            margin: 5px 0;
            background: #1a1a1a;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ip-type {
            color: #00ffff;
            font-weight: bold;
        }

        /* Process List */
        .process-table {
            width: 100%;
            border-collapse: collapse;
        }

        .process-table th {
            background: #0d0d0d;
            padding: 10px;
            text-align: left;
            color: #00ffff;
        }

        .process-table td {
            padding: 10px;
            border-bottom: 1px solid #222;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .modal-content {
            position: relative;
            background: #1a1a1a;
            margin: 50px auto;
            padding: 20px;
            width: 90%;
            max-width: 800px;
            border-radius: 10px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2em;
            cursor: pointer;
            color: #ff0044;
        }

        .code-viewer {
            background: #0d0d0d;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            overflow-x: auto;
        }

        /* Animations */
        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        .loading {
            animation: pulse 1.5s infinite;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #0d0d0d;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>System Control Panel</h1>
            <p>–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–∏—Å—Ç–µ–º–æ–π –∏ —Ñ–∞–π–ª–∞–º–∏</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('system')">–°–∏—Å—Ç–µ–º–∞</div>
            <div class="tab" onclick="showTab('files')">–§–∞–π–ª—ã</div>
            <div class="tab" onclick="showTab('network')">–°–µ—Ç—å</div>
            <div class="tab" onclick="showTab('proxy')">–ü—Ä–æ–∫—Å–∏</div>
            <div class="tab" onclick="showTab('execute')">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
        </div>

        <!-- System Monitor Tab -->
        <div id="system-tab" class="tab-content active">
            <h2>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>CPU</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="cpu-progress" style="width: 0%"></div>
                    </div>
                    <p id="cpu-info">–ó–∞–≥—Ä—É–∑–∫–∞: 0%</p>
                    <p id="cpu-details"></p>
                </div>
                
                <div class="stat-card">
                    <h3>–ü–∞–º—è—Ç—å</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="memory-progress" style="width: 0%"></div>
                    </div>
                    <p id="memory-info">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 0 GB / 0 GB</p>
                </div>

                <div class="stat-card">
                    <h3>–î–∏—Å–∫</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="disk-progress" style="width: 0%"></div>
                    </div>
                    <p id="disk-info">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 0 GB / 0 GB</p>
                </div>

                <div class="stat-card">
                    <h3>–°–µ—Ç—å</h3>
                    <p id="network-sent">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: 0 MB</p>
                    <p id="network-recv">–ü–æ–ª—É—á–µ–Ω–æ: 0 MB</p>
                </div>
            </div>

            <h3>–¢–æ–ø –ø—Ä–æ—Ü–µ—Å—Å–æ–≤</h3>
            <table class="process-table">
                <thead>
                    <tr>
                        <th>PID</th>
                        <th>–ò–º—è</th>
                        <th>CPU %</th>
                        <th>RAM %</th>
                    </tr>
                </thead>
                <tbody id="process-list">
                    <tr><td colspan="4">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- File Manager Tab -->
        <div id="files-tab" class="tab-content">
            <h2>–§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä</h2>
            <div class="file-controls">
                <button class="btn btn-primary" onclick="uploadFile()">üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
                <button class="btn btn-secondary" onclick="uploadFolder()">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–∞–ø–∫—É</button>
                <button class="btn" style="background: linear-gradient(135deg, #ff6600, #cc4400); color: #fff;" onclick="installArchive()">üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –∞—Ä—Ö–∏–≤–∞</button>
                <button class="btn" onclick="createFolder()">‚ûï –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É</button>
                <button class="btn btn-danger" onclick="deleteSelected()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                <button class="btn" onclick="refreshFiles()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                <button class="btn" onclick="loadFiles('.')" style="background: #444;">üè† –ö–æ—Ä–µ–Ω—å</button>
            </div>
            
            <p id="current-path">–ü—É—Ç—å: /</p>
            
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞–ø–æ–∫ -->
            <div id="upload-progress" style="display: none; margin: 10px 0;">
                <div style="color: #00ffff; margin-bottom: 5px;">
                    <span id="upload-status">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–ø–∫–∏...</span>
                    <span id="upload-counter" style="float: right;">0/0</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="upload-progress-bar" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="file-browser" id="file-browser">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...</div>
            </div>

            <input type="file" id="file-input" style="display: none;" onchange="handleFileUpload(event)">
            <input type="file" id="folder-input" style="display: none;" webkitdirectory directory multiple onchange="handleFolderUpload(event)">
            <input type="file" id="archive-input" style="display: none;" accept=".zip,.rar,.7z,.tar,.tar.gz,.tgz,.tar.bz2,.tar.xz" onchange="handleArchiveInstall(event)">
        </div>

        <!-- Network Tab -->
        <div id="network-tab" class="tab-content">
            <h2>–°–µ—Ç–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <div class="ip-list" id="ip-list">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ IP –∞–¥—Ä–µ—Å–æ–≤...</div>
            </div>
        </div>

        <!-- Proxy Tab -->
        <div id="proxy-tab" class="tab-content">
            <h2>–í–µ–±-–ø—Ä–æ–∫—Å–∏</h2>
            <div class="proxy-controls">
                <input type="text" class="url-input" id="proxy-url" placeholder="–í–≤–µ–¥–∏—Ç–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: google.com, yandex.ru)" value="">
                <button class="btn btn-primary" onclick="loadProxyUrl()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                <button class="btn" onclick="clearProxy()">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div id="proxy-status" style="margin: 10px 0; color: #00ffff;"></div>
            <iframe class="proxy-frame" id="proxy-frame" src="about:blank" style="background: white;"></iframe>
        </div>

        <!-- Execute Tab -->
        <div id="execute-tab" class="tab-content">
            <h2>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Python —Å–∫—Ä–∏–ø—Ç–æ–≤</h2>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ Python —Ñ–∞–π–ª –≤ —Ñ–∞–π–ª–æ–≤–æ–º –º–µ–Ω–µ–¥–∂–µ—Ä–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–í—ã–ø–æ–ª–Ω–∏—Ç—å"</p>
            <div id="execute-output" class="code-viewer" style="margin-top: 20px; display: none;">
                <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</h3>
                <pre id="execute-result"></pre>
            </div>
        </div>
    </div>

    <!-- File Viewer Modal -->
    <div id="file-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 id="modal-title">–ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞</h2>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        let currentPath = '.';
        let selectedFile = null;
        let systemUpdateInterval;

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');

            if (tabName === 'system') {
                startSystemMonitoring();
            } else {
                stopSystemMonitoring();
            }

            if (tabName === 'files') {
                loadFiles(currentPath);
            } else if (tabName === 'network') {
                loadNetworkInfo();
            }
        }

        // System monitoring
        function startSystemMonitoring() {
            updateSystemInfo();
            systemUpdateInterval = setInterval(updateSystemInfo, 2000);
        }

        function stopSystemMonitoring() {
            if (systemUpdateInterval) {
                clearInterval(systemUpdateInterval);
            }
        }

        async function updateSystemInfo() {
            try {
                const response = await fetch('/api/system-info');
                const data = await response.json();

                // CPU
                document.getElementById('cpu-progress').style.width = data.cpu.percent + '%';
                document.getElementById('cpu-info').textContent = `–ó–∞–≥—Ä—É–∑–∫–∞: ${data.cpu.percent.toFixed(1)}%`;
                document.getElementById('cpu-details').textContent = 
                    `–Ø–¥–µ—Ä: ${data.cpu.count}, –ß–∞—Å—Ç–æ—Ç–∞: ${data.cpu.frequency.current.toFixed(0)} MHz`;

                // Memory
                const memUsedGB = (data.memory.used / 1024 / 1024 / 1024).toFixed(1);
                const memTotalGB = (data.memory.total / 1024 / 1024 / 1024).toFixed(1);
                document.getElementById('memory-progress').style.width = data.memory.percent + '%';
                document.getElementById('memory-info').textContent = 
                    `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${memUsedGB} GB / ${memTotalGB} GB`;

                // Disk
                const diskUsedGB = (data.disk.used / 1024 / 1024 / 1024).toFixed(1);
                const diskTotalGB = (data.disk.total / 1024 / 1024 / 1024).toFixed(1);
                document.getElementById('disk-progress').style.width = data.disk.percent + '%';
                document.getElementById('disk-info').textContent = 
                    `–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${diskUsedGB} GB / ${diskTotalGB} GB`;

                // Network
                const sentMB = (data.network.bytes_sent / 1024 / 1024).toFixed(1);
                const recvMB = (data.network.bytes_recv / 1024 / 1024).toFixed(1);
                document.getElementById('network-sent').textContent = `–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: ${sentMB} MB`;
                document.getElementById('network-recv').textContent = `–ü–æ–ª—É—á–µ–Ω–æ: ${recvMB} MB`;

                // Processes
                const processList = document.getElementById('process-list');
                processList.innerHTML = data.processes.map(proc => `
                    <tr>
                        <td>${proc.pid}</td>
                        <td>${proc.name}</td>
                        <td>${proc.cpu_percent.toFixed(1)}%</td>
                        <td>${proc.memory_percent.toFixed(1)}%</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error updating system info:', error);
            }
        }

        // File manager
        async function loadFiles(path) {
            try {
                console.log('Loading files for path:', path); // –û—Ç–ª–∞–¥–∫–∞
                const response = await fetch(`/api/files?path=${encodeURIComponent(path)}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                currentPath = data.current_path;
                document.getElementById('current-path').textContent = `–ü—É—Ç—å: ${currentPath}`;
                
                const browser = document.getElementById('file-browser');
                let html = '';
                
                if (path !== '.' && data.parent_path !== data.current_path) {
                    // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –ø—É—Ç—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                    const safeParentPath = data.parent_path.replace(/'/g, "\\'");
                    html += `
                        <div class="file-item" onclick="navigateToFolder('${safeParentPath}')">
                            <span class="file-icon folder-icon">üìÅ</span>
                            <span>..</span>
                        </div>
                    `;
                }
                
                data.items.forEach(item => {
                    const icon = item.is_dir ? 'üìÅ' : 
                                item.name.endsWith('.py') ? 'üêç' : 'üìÑ';
                    const iconClass = item.is_dir ? 'folder-icon' : 
                                     item.name.endsWith('.py') ? 'python-icon' : '';
                    
                    // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –ø—É—Ç—å –∏ –∏–º—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                    const safePath = item.path.replace(/'/g, "\\'").replace(/\\/g, "\\\\");
                    const safeName = item.name.replace(/'/g, "\\'");
                    
                    html += `
                        <div class="file-item" onclick="selectFile('${safePath}', ${item.is_dir}, '${safeName}')">
                            <span class="file-icon ${iconClass}">${icon}</span>
                            <span style="flex: 1">${item.name}</span>
                            <span style="font-size: 0.8em; color: #666">
                                ${item.is_dir ? '' : formatFileSize(item.size)}
                            </span>
                        </div>
                    `;
                });
                
                browser.innerHTML = html;
            } catch (error) {
                console.error('Error loading files:', error);
                const browser = document.getElementById('file-browser');
                browser.innerHTML = `
                    <div style="color: #ff4444; padding: 20px; text-align: center;">
                        <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤</h3>
                        <p>${error.message}</p>
                        <button class="btn" onclick="loadFiles('.')">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–æ—Ä–µ–Ω—å</button>
                    </div>
                `;
            }
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            if (bytes < 1024 * 1024 * 1024) return (bytes / 1024 / 1024).toFixed(1) + ' MB';
            return (bytes / 1024 / 1024 / 1024).toFixed(1) + ' GB';
        }

        function selectFile(path, isDir, name) {
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—É—Ç—å
            path = path.trim();
            
            if (isDir) {
                console.log('Navigating to folder:', path); // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                navigateToFolder(path);
            } else {
                // –í—ã–¥–µ–ª—è–µ–º —Ñ–∞–π–ª
                document.querySelectorAll('.file-item').forEach(item => {
                    item.classList.remove('selected');
                });
                event.currentTarget.classList.add('selected');
                selectedFile = { path, name };
                
                // –ï—Å–ª–∏ —ç—Ç–æ Python —Ñ–∞–π–ª, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                if (name.endsWith('.py')) {
                    showExecuteButton(path);
                } else {
                    // –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞
                    viewFile(path, name);
                }
            }
        }

        function navigateToFolder(path) {
            // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –ø—É—Ç—å
            path = path.trim();
            
            // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
            try {
                path = decodeURIComponent(path);
            } catch (e) {
                // –ï—Å–ª–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—É—Ç—å –∫–∞–∫ –µ—Å—Ç—å
            }
            
            loadFiles(path);
        }

        async function viewFile(path, name) {
            try {
                const response = await fetch(`/api/file-content/${encodeURIComponent(path)}`);
                const data = await response.json();
                
                const modal = document.getElementById('file-modal');
                const modalTitle = document.getElementById('modal-title');
                const modalBody = document.getElementById('modal-body');
                
                modalTitle.textContent = `–ü—Ä–æ—Å–º–æ—Ç—Ä: ${name}`;
                
                if (data.type === 'text') {
                    modalBody.innerHTML = `<pre class="code-viewer">${escapeHtml(data.content)}</pre>`;
                } else if (data.type === 'image') {
                    modalBody.innerHTML = `<img src="${data.url}" style="max-width: 100%;">`;
                } else {
                    modalBody.innerHTML = `<p>–ë–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª (${formatFileSize(data.size)})</p>`;
                }
                
                modal.style.display = 'block';
            } catch (error) {
                console.error('Error viewing file:', error);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showExecuteButton(path) {
            const executeTab = document.getElementById('execute-tab');
            executeTab.innerHTML = `
                <h2>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Python —Å–∫—Ä–∏–ø—Ç–∞</h2>
                <p>–§–∞–π–ª: ${path}</p>
                <button class="btn btn-primary" onclick="executePython('${path}')">–í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∫—Ä–∏–ø—Ç</button>
                <div id="execute-output" class="code-viewer" style="margin-top: 20px; display: none;">
                    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</h3>
                    <pre id="execute-result"></pre>
                </div>
            `;
        }

        async function executePython(path) {
            const output = document.getElementById('execute-output');
            const result = document.getElementById('execute-result');
            
            output.style.display = 'block';
            result.textContent = '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ...';
            
            try {
                const response = await fetch('/api/execute-python', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ path })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    result.innerHTML = `
                        <strong>–ö–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞:</strong> ${data.returncode}<br>
                        <strong>–í—ã–≤–æ–¥:</strong><br>${escapeHtml(data.stdout || '–ù–µ—Ç –≤—ã–≤–æ–¥–∞')}<br>
                        <strong>–û—à–∏–±–∫–∏:</strong><br>${escapeHtml(data.stderr || '–ù–µ—Ç –æ—à–∏–±–æ–∫')}
                    `;
                } else {
                    result.textContent = `–û—à–∏–±–∫–∞: ${data.error}`;
                }
            } catch (error) {
                result.textContent = `–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${error}`;
            }
        }

        function closeModal() {
            document.getElementById('file-modal').style.display = 'none';
        }

        function uploadFile() {
            document.getElementById('file-input').click();
        }

        function uploadFolder() {
            document.getElementById('folder-input').click();
        }

        function installArchive() {
            document.getElementById('archive-input').click();
        }

        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('path', currentPath);
            
            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                if (data.success) {
                    loadFiles(currentPath);
                } else {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + data.error);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error);
            }
        }

        async function handleFolderUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;

            const progressDiv = document.getElementById('upload-progress');
            const statusSpan = document.getElementById('upload-status');
            const counterSpan = document.getElementById('upload-counter');
            const progressBar = document.getElementById('upload-progress-bar');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            progressDiv.style.display = 'block';
            statusSpan.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–ø–∫–∏...';
            counterSpan.textContent = `0/${files.length}`;
            progressBar.style.width = '0%';

            let uploadedCount = 0;
            let hasErrors = false;

            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª—ã –ø–æ –æ–¥–Ω–æ–º—É –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                    statusSpan.textContent = `–ó–∞–≥—Ä—É–∑–∫–∞: ${file.name}`;
                    
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('path', currentPath);
                    formData.append('relative_path', file.webkitRelativePath || file.name);

                    try {
                        const response = await fetch('/api/upload-folder', {
                            method: 'POST',
                            body: formData
                        });

                        const data = await response.json();
                        if (!data.success) {
                            console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${file.name}:`, data.error);
                            hasErrors = true;
                        }
                    } catch (error) {
                        console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${file.name}:`, error);
                        hasErrors = true;
                    }

                    uploadedCount++;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                    const progress = Math.round((uploadedCount / files.length) * 100);
                    progressBar.style.width = progress + '%';
                    counterSpan.textContent = `${uploadedCount}/${files.length}`;
                }

                // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                setTimeout(() => {
                    progressDiv.style.display = 'none';
                }, 1000);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                if (hasErrors) {
                    statusSpan.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–∞–º–∏';
                    statusSpan.style.color = '#ffaa00';
                    setTimeout(() => {
                        alert('–ü–∞–ø–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã –º–æ–≥–ª–∏ –±—ã—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
                    }, 500);
                } else {
                    statusSpan.textContent = '–ü–∞–ø–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!';
                    statusSpan.style.color = '#00ff00';
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
                loadFiles(currentPath);

            } catch (error) {
                progressDiv.style.display = 'none';
                alert('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞–ø–∫–∏: ' + error);
            }

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º input
            event.target.value = '';
        }

        async function handleArchiveInstall(event) {
            const file = event.target.files[0];
            if (!file) return;

            // –°–ø—Ä–∞—à–∏–≤–∞–µ–º —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ–∑–¥–∞–≤–∞—Ç—å –ª–∏ –ø–∞–ø–∫—É —Å –∏–º–µ–Ω–µ–º –∞—Ä—Ö–∏–≤–∞
            const createFolder = confirm(
                `–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É —Å –∏–º–µ–Ω–µ–º "${file.name.split('.')[0]}" –¥–ª—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∞—Ä—Ö–∏–≤–∞?\n\n` +
                `–î–ê - —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É\n` +
                `–ù–ï–¢ - –∏–∑–≤–ª–µ—á—å –≤ —Ç–µ–∫—É—â—É—é –ø–∞–ø–∫—É`
            );

            const progressDiv = document.getElementById('upload-progress');
            const statusSpan = document.getElementById('upload-status');
            const counterSpan = document.getElementById('upload-counter');
            const progressBar = document.getElementById('upload-progress-bar');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            progressDiv.style.display = 'block';
            statusSpan.textContent = `–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞—Ä—Ö–∏–≤–∞: ${file.name}`;
            statusSpan.style.color = '#00ffff';
            counterSpan.textContent = '–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ...';
            progressBar.style.width = '50%';

            const formData = new FormData();
            formData.append('file', file);
            formData.append('path', currentPath);
            formData.append('create_folder', createFolder ? 'true' : 'false');

            try {
                const response = await fetch('/api/install-archive', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    // –£—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
                    statusSpan.textContent = `‚úÖ ${data.message}`;
                    statusSpan.style.color = '#00ff00';
                    counterSpan.textContent = `–ò–∑–≤–ª–µ—á–µ–Ω–æ –≤: ${data.extracted_to}`;
                    progressBar.style.width = '100%';

                    setTimeout(() => {
                        progressDiv.style.display = 'none';
                        alert(`–ê—Ä—Ö–∏–≤ "${data.archive_name}" —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!\n\n–ü—É—Ç—å: ${data.extracted_to}`);
                        loadFiles(currentPath);
                    }, 2000);

                } else {
                    // –û—à–∏–±–∫–∞
                    statusSpan.textContent = `‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏`;
                    statusSpan.style.color = '#ff4444';
                    counterSpan.textContent = data.error;
                    progressBar.style.width = '100%';

                    setTimeout(() => {
                        progressDiv.style.display = 'none';
                        alert(`–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞—Ä—Ö–∏–≤–∞:\n${data.error}`);
                    }, 3000);
                }

            } catch (error) {
                statusSpan.textContent = `‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞`;
                statusSpan.style.color = '#ff4444';
                counterSpan.textContent = error.toString();
                progressBar.style.width = '100%';

                setTimeout(() => {
                    progressDiv.style.display = 'none';
                    alert(`–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:\n${error}`);
                }, 3000);
            }

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º input
            event.target.value = '';
        }

        async function createFolder() {
            const name = prompt('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–∞–ø–∫–∏:');
            if (!name) return;
            
            try {
                const response = await fetch('/api/create-folder', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ path: currentPath, name })
                });
                
                const data = await response.json();
                if (data.success) {
                    loadFiles(currentPath);
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error);
            }
        }

        async function deleteSelected() {
            if (!selectedFile) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }
            
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å ${selectedFile.name}?`)) return;
            
            try {
                const response = await fetch('/api/delete', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ path: selectedFile.path })
                });
                
                const data = await response.json();
                if (data.success) {
                    selectedFile = null;
                    loadFiles(currentPath);
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error);
            }
        }

        function refreshFiles() {
            loadFiles(currentPath);
        }

        // Network info
        async function loadNetworkInfo() {
            try {
                const response = await fetch('/api/network-info');
                const data = await response.json();
                
                const ipList = document.getElementById('ip-list');
                ipList.innerHTML = '<h3>–í—Å–µ IP –∞–¥—Ä–µ—Å–∞ —Å–∏—Å—Ç–µ–º—ã:</h3>';
                
                data.ips.forEach(ip => {
                    ipList.innerHTML += `
                        <div class="ip-item">
                            <div>
                                <span class="ip-type">${ip.type.toUpperCase()}</span>
                                ${ip.interface ? `(${ip.interface})` : ''}
                                ${ip.hostname ? `- ${ip.hostname}` : ''}
                            </div>
                            <div>
                                <strong>${ip.ip}</strong>
                                ${ip.netmask && ip.netmask !== 'N/A' ? ` / ${ip.netmask}` : ''}
                            </div>
                        </div>
                    `;
                });
            } catch (error) {
                console.error('Error loading network info:', error);
            }
        }

        // Proxy
        function loadProxyUrl() {
            const url = document.getElementById('proxy-url').value.trim();
            if (!url) {
                alert('–í–≤–µ–¥–∏—Ç–µ URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏');
                return;
            }
            
            const status = document.getElementById('proxy-status');
            const frame = document.getElementById('proxy-frame');
            
            status.textContent = `–ó–∞–≥—Ä—É–∑–∫–∞ ${url}...`;
            status.style.color = '#00ffff';
            
            try {
                frame.src = `/api/proxy?url=${encodeURIComponent(url)}`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
                setTimeout(() => {
                    status.textContent = `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${url}`;
                    status.style.color = '#00ff00';
                }, 1000);
                
            } catch (error) {
                status.textContent = `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error}`;
                status.style.color = '#ff4444';
            }
        }

        function clearProxy() {
            const frame = document.getElementById('proxy-frame');
            const status = document.getElementById('proxy-status');
            
            frame.src = 'about:blank';
            status.textContent = '';
            document.getElementById('proxy-url').value = '';
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Enter –≤ –ø–æ–ª–µ URL
        document.addEventListener('DOMContentLoaded', function() {
            const urlInput = document.getElementById('proxy-url');
            if (urlInput) {
                urlInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        loadProxyUrl();
                    }
                });
            }
        });

        // Initialize
        window.onload = function() {
            startSystemMonitoring();
        };

        // Close modal on click outside
        window.onclick = function(event) {
            const modal = document.getElementById('file-modal');
            if (event.target === modal) {
                closeModal();
            }
        };
    </script>
</body>
</html> 